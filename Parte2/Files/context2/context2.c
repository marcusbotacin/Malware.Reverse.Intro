#include<stdio.h>
#include<string.h>
#include<stdlib.h>
#include <sys/types.h>
#include <unistd.h>
#define BUF_SIZE 1024
//Expected parent is bash and not a trace program
#define EXPECTED_PARENT "bash\n\x7f"
int main()
{
	//Retrieves parent pid
	int parent = getppid();
	char buf[BUF_SIZE],comm[BUF_SIZE];
	sprintf(comm,"/proc/%d/comm",parent);
	FILE *f=fopen(comm,"r");
	fread(buf,1,BUF_SIZE,f);
	//Compares received parent pid with expected, if no match then exit => Program is under a trace
	if(strcmp(buf,EXPECTED_PARENT)!=0)
	{
		exit(0);
	}
	printf("I'm a malware\n");
	return 0;
}
